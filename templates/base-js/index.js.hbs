var { useAgent } = require('@nestbox-ai/functions');
var { OpenAI } = require('openai');

const MODEL_NAME = 'openai/gpt-oss-20b';

const client = new OpenAI({
  baseURL: 'http://localhost:8000/v1',
  apiKey: 'sk-xxxxxx'
});

var {{agentName}} = useAgent(async (context, events) => {

    const response = await client.chat.completions.create({
      model: MODEL_NAME,
      messages: [
        {
          role: "user",
          content: "Why is the sky blue?"
        }
      ]
    });
    const result = response.choices[0].message.content;
    if (!result) {
      events.emitQueryFailed({ data: { error: 'No response from model' } });
    } else {
      events.emitQueryCompleted({ data: result });
    }
});

module.exports = { {{agentName}} };
